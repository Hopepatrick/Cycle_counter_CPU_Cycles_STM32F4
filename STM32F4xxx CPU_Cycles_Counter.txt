#include <stdio.h>
#include <stdint.h>
#include <math.h>
#include "stm32f4xx.h"   // Example: STM32F4 series (Cortex-M4F with FPU)

// Function to get CPU cycle counter
static inline uint32_t get_cycles(void) {
    return DWT->CYCCNT;
}

int main(void) {
    // Enable DWT cycle counter
    CoreDebug->DEMCR |= CoreDebug_DEMCR_TRCENA_Msk;
    DWT->CYCCNT = 0;  
    DWT->CTRL |= DWT_CTRL_CYCCNTENA_Msk;

    float a = 1.234f, b = 2.345f, c;
    uint32_t start, end;

    // Benchmark 1000 floating-point multiplications
    start = get_cycles();
    for (int i = 0; i < 1000; i++) {
        c = a * b;
    }
    end = get_cycles();

    uint32_t cycles = end - start;
    printf("Total cycles: %lu\n", cycles);
    printf("Cycles per multiplication: %lu\n", cycles / 1000);

    while(1);
}
